/**
 * Framework7 Feeds 1.0.1
 * Framework7 Feeds plugin brings easy RSS feeds integration into Framework7 app
 * 
 * http://www.idangero.us/framework7/plugins/
 * 
 * Copyright 2015, Vladimir Kharlampidi
 * The iDangero.us
 * http://www.idangero.us/
 * 
 * Licensed under MIT
 * 
 * Released on: August 22, 2015
 */
Framework7.prototype.plugins.feeds=function(e){"use strict";function t(t){a(t.container).find(".feeds-init").each(function(){var t=a(this);e.feeds(this,{url:t.attr("data-url"),openIn:t.attr("data-openIn")||void 0,virtualList:t.attr("data-virtualList")||void 0,listTemplate:t.attr("data-listTemplate")&&e.templates&&e.templates[t.attr("data-listTemplate")]||void 0,itemPageTemplate:t.attr("data-itemPageTemplate")&&e.templates&&e.templates[t.attr("data-itemPageTemplate")]||void 0,itemPopupTemplate:t.attr("data-itemPopupTemplate")&&e.templates&&e.templates[t.attr("data-itemPopupTemplate")]||void 0})})}var a=window.Dom7,i=window.Template7,l=function(t,l){var n=this,s={openIn:"page",formatDate:function(e){e=new Date(e);var t="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ");return t[e.getMonth(e)]+" "+e.getDate(e)+", "+e.getFullYear()}};l=l||{};for(var r in s)"undefined"==typeof l[r]&&(l[r]=s[r]);n.params=l,n.data={},n.container=a(t);var p='<ul>{{#each items}}<li><a href="#" class="item-link item-content feeds-item-link" data-index="{{@index}}"><div class="item-inner"><div class="item-title">{{title}}</div><div class="item-after">{{formattedDate}}</div></div></a></li>{{/each}}</ul>',m='<li><a href="#" class="item-link item-content feeds-item-link" data-index="{{@index}}"><div class="item-inner"><div class="item-title">{{title}}</div><div class="item-after">{{formattedDate}}</div></div></a></li>',d='<div class="navbar"><div class="navbar-inner"><div class="left sliding"><a href="#" class="back link"><i class="icon icon-back"></i><span>Back</span></a></div><div class="center sliding">{{title}}</div></div></div>',c="static";n.container.parents(".navbar-fixed").length>0&&(c="fixed"),n.container.parents(".navbar-through").length>0&&(c="through");var o=("through"===c?d:"")+'<div class="page feeds-page '+("fixed"===c?"navbar-fixed":"")+'" data-page="feeds-page-{{index}}">'+("fixed"===c?d:"")+'<div class="page-content">'+("static"===c?d:"")+'<div class="content-block"><a href="{{link}}" class="external" target="_blank">{{title}}</a><br><small>{{formattedDate}}</small></div><div class="content-block"><div class="content-block-inner">{{description}}</div></div></div></div>',v='<div class="popup"><div class="view navbar-fixed"><div class="navbar"><div class="navbar-inner"><div class="left sliding"><a href="#" class="close-popup link"><i class="icon icon-back"></i><span>Close</span></a></div><div class="center sliding">{{title}}</div></div></div><div class="pages"><div class="page feeds-page" data-page="feeds-page-{{index}}"><div class="page-content"><div class="content-block"><a href="{{link}}" class="external" target="_blank">{{title}}</a><br><small>{{formattedDate}}</small></div><div class="content-block"><div class="content-block-inner">{{description}}</div></div></div></div></div></div></div>';return n.params.listTemplate?"function"==typeof n.params.listTemplate?n.listTemplate=n.params.listTemplate:"string"==typeof n.params.listTemplate&&(n.listTemplate=i.compile(n.params.listTemplate)):n.listTemplate=i.compile(p),n.params.itemPageTemplate?"function"==typeof n.params.itemPageTemplate?n.itemPageTemplate=n.params.itemPageTemplate:"string"==typeof n.params.itemPageTemplate&&(n.itemPageTemplate=i.compile(n.params.itemPageTemplate)):n.itemPageTemplate=i.compile(o),n.params.itemPopupTemplate?"function"==typeof n.params.itemPopupTemplate?n.itemPopupTemplate=n.params.itemPopupTemplate:"string"==typeof n.params.itemPopupTemplate&&(n.itemPopupTemplate=i.compile(n.params.itemPopupTemplate)):n.itemPopupTemplate=i.compile(v),n.loadFeed=function(t){n.params.onAjaxStart&&n.params.onAjaxStart(n),a.get(n.params.url,function(i){n.params.onAjaxComplete&&n.params.onAjaxComplete(n,i);var l=new DOMParser,s=l.parseFromString(i,"text/xml"),r=a(s).find("rss > channel");if(0!==r.length){n.data={title:r.children("title").text(),link:r.children("link").text(),description:r.children("description").text().replace("<![CDATA[","").replace("]]>",""),copyright:r.children("copyright").text(),image:{url:r.children("image").children("url").text(),title:r.children("image").children("title").text(),link:r.children("image").children("link").text(),width:r.children("image").children("width").text(),height:r.children("image").children("height").text()},items:[]};var p=r.find("item");p.each(function(e,t){var i=a(t),l={title:i.children("title").text().replace("<![CDATA[","").replace("]]>",""),link:i.children("link").text(),description:i.children("description").text().replace("<![CDATA[","").replace("]]>",""),pubDate:i.children("pubDate").text(),formattedDate:n.params.formatDate(i.children("pubDate").text()),guid:i.children("guid").text(),index:n.data.items.length};n.params.customItemFields&&n.params.customItemFields.length>0&&i.children().each(function(){for(var e=0;e<n.params.customItemFields.length;e++){var t=n.params.customItemFields[e].split("||")[0],i=n.params.customItemFields[e].split("||")[1];this.nodeName===t&&(l[t.replace(/:/g,"")]=i?this.getAttribute(i):a(this).text().replace("<![CDATA[","").replace("]]>",""))}}),n.data.items.push(l)}),n.params.virtualList?t?n.virtualList.replaceAllItems(n.data.items):(("true"===n.params.virtualList||n.params.virtualList===!0)&&(n.params.virtualList={}),n.params.virtualList.items=n.data.items,n.params.virtualList.template=n.params.virtualList.template||m,n.virtualList=e.virtualList(n.container,n.params.virtualList)):n.container.html(n.listTemplate(n.data)),t&&e.pullToRefreshDone(n.container.parents(".pull-to-refresh-content"))}})},n.refreshFeed=function(){return n.loadFeed(!0)},n.openItem=function(t){if("page"===n.params.openIn){var a=n.container.parents("."+e.params.viewClass)[0].f7View;if(!a)return;a.router.load({template:n.itemPageTemplate,context:t})}else"popup"===n.params.openIn&&e.popup(n.itemPopupTemplate(t))},n.container.on("click","a.feeds-item-link",function(e){e.preventDefault();var t=a(this).data("index");n.openItem(n.data.items[t])}),n.container.parents(".pull-to-refresh-content").on("refresh",function(){a(this);n.refreshFeed()}),n.loadFeed(),n.container[0].f7Feed=n,n};return e.feeds=function(e,t){return new l(e,t)},{hooks:{pageInit:t}}};